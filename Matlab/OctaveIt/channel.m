function [rx,canal] = channel(tx,Tsymb,NFFT,verbose)

%% dummy channel
% deltaF = 1/Tsymb;
% k = -NFFT/2:NFFT/2-1;
% canal = 0.4*exp(-1j*2*pi*deltaF*k*1e-6)+0.1*exp(-1j*2*pi*deltaF*k*5.4e-6);
% canalTiempo = ifft(ifftshift(canal));


%% Channel
param = [0.057662 1.003019 4.855121 
 0.176809 5.422091 3.419109 
 0.407163 0.518650 5.864470 
 0.303585 2.751772 2.215894 
 0.258782 0.602895 3.758058 
 0.061831 1.016585 5.430202 
 0.150340 0.143556 3.952093 
 0.051534 0.153832 1.093586 
 0.185074 3.324866 5.775198 
 0.400967 1.935570 0.154459 
 0.295723 0.429948 5.928383 
 0.350825 3.228872 3.053023 
 0.262909 0.848831 0.628578 
 0.225894 0.073883 2.128544 
 0.170996 0.203952 1.099463 
 0.149723 0.194207 3.462951 
 0.240140 0.924450 3.664773 
 0.116587 1.381320 2.833799 
 0.221155 0.640512 3.334290 
 0.259730 1.368671 0.393889];

rho = [0.0576620000000000;0.176809000000000;0.407163000000000;0.303585000000000;0.258782000000000;0.0618310000000000;0.150340000000000;0.0515340000000000;0.185074000000000;0.400967000000000;0.295723000000000;0.350825000000000;0.262909000000000;0.225894000000000;0.170996000000000;0.149723000000000;0.240140000000000;0.116587000000000;0.221155000000000;0.259730000000000];
tau = [1.00301900000000;5.42209100000000;0.518650000000000;2.75177200000000;0.602895000000000;1.01658500000000;0.143556000000000;0.153832000000000;3.32486600000000;1.93557000000000;0.429948000000000;3.22887200000000;0.848831000000000;0.0738830000000000;0.203952000000000;0.194207000000000;0.924450000000000;1.38132000000000;0.640512000000000;1.36867100000000].*1e-6;
theta = [4.85512100000000;3.41910900000000;5.86447000000000;2.21589400000000;3.75805800000000;5.43020200000000;3.95209300000000;1.09358600000000;5.77519800000000;0.154459000000000;5.92838300000000;3.05302300000000;0.628578000000000;2.12854400000000;1.09946300000000;3.46295100000000;3.66477300000000;2.83379900000000;3.33429000000000;0.393889000000000];

deltaF = 1/Tsymb;
k = -NFFT/2:NFFT/2-1;
canal = rho.*exp(-1j*theta).*exp(-1j*2*pi*deltaF*repmat(k,20,1).*repmat(tau,1,NFFT));
canal = sum(canal,1);
canalTiempo = ifft(ifftshift(canal));
if verbose
    figure
    plot(deltaF*k,20*log10(abs(fftshift(canal))))
    axis();
    title('Canal en frecuencia')
    xlabel('Frecuencia [Hz]')
    ylabel('|H| [dB]')
    grid
end

rx = conv(canalTiempo,tx);
rx = rx(1:end-NFFT+1);

end